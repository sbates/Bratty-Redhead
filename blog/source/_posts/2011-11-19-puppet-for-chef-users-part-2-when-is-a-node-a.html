--- 
layout: post
title: "Puppet for Chef Users - Part 2 - When is a node a node? "
published: true
date: 2011-11-19
categories: []

posterous_url: http://blog.brattyredhead.com/puppet-for-chef-users-part-2-when-is-a-node-a
posterous_slug: puppet-for-chef-users-part-2-when-is-a-node-a
---
<p><em>Disclaimer: I have been working with Chef for about 18 months and Puppet for about 5 minutes.&nbsp; I don't claim to be an expert on Puppet nor warranty this information in any way.&nbsp; It could all be egregiously wrong.&nbsp; This is simply a blog exploring what I'm learning.</em><p />When is a node a node?&nbsp; And when is it a thought?&nbsp; Or a regex? When is it a description of a certain state of being?<p />When I first started working in someone else's existing puppet domain, I was confused.&nbsp; Everything was described in puppet/manifests/site.pp.&nbsp; There was a lot of description.&nbsp; Everything was called a node, regardless of what kind of object it was describing. Lists of manifests/classes were nodes, named servers were nodes, there were some regexs also designated nodes.&nbsp; I was confused.<p />Check it out.&nbsp; In Chef there are nodes.&nbsp; A node is always the endpoint in question.&nbsp; It's a concrete item.&nbsp; It just....is.&nbsp; A VM is a node.&nbsp; An AWS instance is a node.&nbsp; If you want to describe a node, you add recipes or roles to it.&nbsp; A recipe is a single thing.&nbsp; A role is a collection of recipes, attributes and information that comprises a functional entity.<p />In Puppet, a node is a much more nebulous concept.&nbsp; A node is still always the client endpoint.&nbsp; But, the node can also be a described end state.<p />Let's use the ubiquitous webserver example.&nbsp; In my webserver, I will probably need a set of base OS modules/cookbooks and some webserver stuff.&nbsp; I might have a requirement set that looks like this:<p />[ dns, ntp, ssh, syslog, puppet-agent|chef-client, apache, openssl, memcached ]<p />There are some differences in Puppet and Chef management structure.&nbsp; In Chef, a node is a client, an endpoint. It's pretty much always a server, whether hardware, VM or cloud instance.<p />In Chef I would write cookbooks for each of the items in my set.&nbsp; Then I would probably create two roles: dotcom_base and webserver<p /><strong>roles/com_base.rb</strong><br /><strong>--------------------</strong><br />name "dotcom_base"<br />description "The base role for ALL systems"<br />run_list(<br />&nbsp;&nbsp;&nbsp; "recipe[chef-client]",<br />&nbsp;&nbsp;&nbsp; "recipe[syslog]", &nbsp;<br />&nbsp;&nbsp;&nbsp; "recipe[ssh]",<br />&nbsp;&nbsp;&nbsp; "recipe[ntp]",<br />&nbsp;&nbsp;&nbsp; "recipe[dns]"<br />)<p /><strong>roles/webserver.rb</strong><br /><strong>---------------------</strong><br />name "webserver"<br />description "Role for Webservers"<br />run_list(<br />&nbsp;&nbsp;&nbsp; "recipe[apache]",<br />&nbsp;&nbsp;&nbsp; "recipe[openssl]", &nbsp;<br />&nbsp;&nbsp;&nbsp; "recipe[memcached]"<br />)<p />At this point I would then add both roles to any webserver node in my farm.&nbsp; Or the roles would be added at bootstrap or your choice.&nbsp; This information goes into node attributes stored in the attribute database.&nbsp; There is no flat file representation of actual named nodes.<p />Puppet is all flat file management, requiring node management to be described in flat files.&nbsp; Puppet has also chosen a flexible concept of <strong>node</strong>.<p /> A node can be a collection of similar items:  <br /><strong>node "dotcom_base"</strong> { <br /> &nbsp; include dns<br />&nbsp; include ntp<br />&nbsp; include syslog<br />&nbsp; include puppet_agent<br />}<p />A node can be a type:<br /><strong>node "webserver"</strong>&nbsp; inherits "dotcom_base" {<br />&nbsp; include apache<br />&nbsp; include openssl<br />&nbsp; include memcached<br />&nbsp;}<p />Given dotcom_web1.domain.com, dotcom_web2.domain.com, dotcom_web3.domain.com:<p />A node can just be a single endpoint:<br /><strong>node dotcom_web1.domain.com </strong>inherits "webserver"{ }<p />A node can be a collection of nodes matched with regex.<br /><strong>node /^dotcom_web\d+\.domain\.com$/</strong> inherits "webserver" { }</p>
<p>A thought on node construction: To be more transparent, these could also say <p /><em>inherits "dotcom_base" { webserver }</em><p />While I have not seen this notation, it's what I would do if I were designing from the bottom up.&nbsp; This may or may not be correct style-wise, but I'm a fan of transparency in my config statements.</p>
<p>Puppet node information can either be described in the top level puppet/manifests/site.pp or site.pp can include a second file traditionally called nodes.pp.&nbsp; Site.pp can also include puppet conditionals, environment descriptions and params that might be specific to an environment, similar to Chef's override attributes.</p>
<p>So, to recap, Chef and Puppet both have nodes.&nbsp; Puppet describes many different objects which are all designated nodes.&nbsp; Chef has chosen to break out object descriptions into roles and runlists for nodes.</p>
<p><strong>Chef progression: </strong>cookbook/recipe=&gt; role =&gt; node <br /><strong>Puppet progression: </strong>module/manifest =&gt; typed node description =&gt; specific/regex matched node description</p>
